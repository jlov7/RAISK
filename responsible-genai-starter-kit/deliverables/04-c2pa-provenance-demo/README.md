# D4 — C2PA Provenance Demo

Command-line tools and a lightweight web viewer for signing and verifying AI-generated content using the C2PA 2.2 specification. Built as a research demo with production-grade practices (TypeScript, pinned dependencies, automated tests).

---

## Highlights

- **CLI tools** for signing (`cli-sign.ts`) and verifying (`cli-verify.ts`) image assets.
- **Development certificates** and helper scripts for local experimentation (never for production).
- **Web viewer** that loads C2PA manifests via browser-friendly bundles.
- **Automated smoke tests** (`npm test`) to ensure build artifacts work end-to-end.
- **Postinstall script** that copies C2PA WASM assets into the viewer bundle.

---

## Prerequisites

- Node.js 18 or later
- npm 9+
- OpenSSL (for generating demo certificates)

Verify environment:

```bash
node --version
npm --version
openssl version
```

---

## Install & Build

```bash
cd deliverables/04-c2pa-provenance-demo
npm install
npm run build
```

`npm install` runs `scripts/setup-viewer-assets.cjs` to copy required C2PA WASM blobs into `viewer/vendor/`.

---

## Generate Demo Certificates

```bash
bash examples/generate-dev-certs.sh
```

This script produces:
- `examples/certs/dev-private-key.pem`
- `examples/certs/dev-certificate.pem`

> ⚠️ These keys are **for development only**. They are self-signed, unprotected, and must never be used in production. Replace them with CA-issued certificates and secure key management (HSM, KMS) before real deployments.

---

## Sign Content

```bash
npm run sign -- \
  -i examples/images/photo.jpg \
  -o examples/images/photo-signed.jpg \
  -c examples/certs/dev-certificate.pem \
  -k examples/certs/dev-private-key.pem \
  --title "Demo Image" \
  --author "Research Lab" \
  --ai-generated
```

Key options:
- `--metadata`: Path to custom JSON assertions to merge into the manifest
- `--title`, `--author`: Add schema.org `CreativeWork` metadata
- `--ai-generated`: Add AI-training disclaimers per C2PA 2.2 guidelines

CLI output summarizes the manifest and warns if demo keys are in use.

---

## Verify Content

```bash
npm run verify -- \
  -i examples/images/photo-signed.jpg \
  --detailed
```

Expect structured output indicating manifest validity, signature status, and embedded assertions. Use `--json` (if you extend the CLI) for machine-readable verification logs.

---

## Web Viewer

```bash
npm run viewer
# Opens http://localhost:8080
```

Drop signed assets onto the viewer or point the interface to static files. The viewer bundles C2PA’s ESM/worker assets via the `vendor/` directory populated at install time.

---

## Project Structure

```
04-c2pa-provenance-demo/
├── src/                  # TypeScript sources for CLI tools
├── dist/                 # Transpiled JavaScript (generated by `npm run build`)
├── viewer/               # Static web viewer + vendor assets
├── examples/             # Sample images, metadata, cert generation script
├── scripts/              # Setup utilities (asset copier)
└── test/                 # Smoke tests exercising build + CLI
```

`npm test` verifies TypeScript compilation, certificate presence, CLI help, viewer assets, and metadata examples.

---

## Customization Ideas

- **Additional assertions:** Extend `cli-sign.ts` with domain-specific metadata (e.g., editorial policy, content warnings).
- **Video/Audio support:** Use `getFormatFromFilename` as a starting point and add MIME types, or integrate with ffmpeg for pre-processing.
- **Integration pipeline:** Embed the CLI into your content publishing workflow post-generation but pre-release.
- **Production hardening:** Replace dev certificates, integrate with hardware-backed signing, implement key rotation, and enforce manifest policies.

---

## Integration with Other Modules

- **D2 Evaluation Harness:** Pair signed outputs with evaluation reports to demonstrate provenance + safety combined.
- **D3 Workflows:** Publish signed assets as part of release artifacts alongside SBOMs and provenance attestations.
- **D6 Education Pack:** Use screenshots of the viewer to educate end-users on AI-generated content labels.

---

## Licensing

- Code: MIT (for easier embedding into other Node.js projects)
- Documentation: CC-BY-4.0

Attribute “Responsible GenAI Starter Kit – Jason Lovell” when reusing docs or screenshots.
